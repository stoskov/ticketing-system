@model TicketDetailsViewModel
@{
    this.ViewBag.Title = "Ticketing Details";
}

<h2>Ticket Details</h2>

<div class="page page-create-ticket">

    @Html.Partial("_TicketDetails", this.Model, new ViewDataDictionary { { "RenderButtons", true } })

    <div class="row-fluid separate ticket-subheader">
        Comments(@this.Model.CommentsCount):
    </div>

    @foreach (CommentDetailsViewModel comment in this.Model.Comments)
    {
        @Html.Partial("_CommentPartial", comment);
    }

    <div class="row-fluid">
        <div class="pagination">
            <ul>
                @if (ViewBag.CurrentPage > 1)
                {
                    <li>
                        <a href='@Url.Action("Details", new { commentsPage = ViewBag.CurrentPage - 1 })'>Prev</a>
                    </li>
                }
                else
                {
                    <li class="disabled">
                        <a href='#'>Prev</a>
                    </li>
                }

                @if (ViewBag.CurrentPage < ViewBag.PagesCount)
                {
                    <li>
                        <a href='@Url.Action("Details", new { commentsPage = ViewBag.CurrentPage + 1 })'>Next</a>
                    </li>
                }
                else
                {
                    <li class="disabled">
                        <a href='#'>Next</a>
                    </li>
                }

            </ul>
        </div>
    </div>

    @{
        if (User.Identity.IsAuthenticated)
        {
            var commentViewMode = new CommentDetailsViewModel() { TicketId = this.Model.Id };

            <div class="row-fluid separate ticket-subheader">
                Leave a comment
            </div>

            <div class="row-fluid">
                @Html.Partial("_PostCommentPartial", commentViewMode)
            </div>
        }
    }
</div>